<!doctype html>
<html lang="en" style="height:100%">

<head>
  <meta charset="utf-8">
  <title>随机点名系统</title>
  <base href="./">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" type="text/css" href="./css/base.css">
 
</head>

<body>
  <!-- 随机点名模块 -->
  <div class="random-container" id="random-container">
    <div class="choose">
		<button id="addtea">加分</button>
		<button id="addsalt">减分</button>
		<button id="addbg">背景</button>
      <select name="chooseClass" id="chooseClass">
      </select>
    </div>
    <div id="lucky">
      <span class="name" id="luckyName">随机点名</span>
      <!-- 随机点名 -->
    </div>
  </div>
</body>

<script>

  var school = [
    {
      "clzname": '高一A班',
      "students": [
        "九纹龙",
        "神机军",
        "跳涧虎",
        "白花蛇",
        "花和尚",
        "打虎将",
        "小霸王"
      ]
    },
    {
      "clzname": '高一B班',
      "students": [
        "九纹龙B",
        "神机军B",
        "跳涧虎B",
        "白花蛇B",
        "花和尚B",
        "打虎将B",
        "小霸王B"
      ]
    },
    {
      "clzname": '高一C班',
      "students": [
        "九纹龙C",
        "神机军C",
        "跳涧虎C",
        "白花蛇C",
        "花和尚C",
        "打虎将C",
        "小霸王C"
      ]
    }
	]

  var rdmContainer = document.getElementById("random-container");//获取元素
  var luckyName = document.getElementById("luckyName");//获取元素
  var selectClass = document.getElementById("chooseClass");//获取元素
  var addtea = document.getElementById("addtea")
  var addsalt = document.getElementById("addsalt")
  var addbg = document.getElementById("addbg")
  var selHtml = ''
  var aaCount = 0
  for(var ii = 0;ii<school.length;ii++){
    selHtml= selHtml+'<option value="'+aaCount+'">'+ school[ii].clzname+'</option>'
	  aaCount++
  }
  console.log(selHtml)
  selectClass.innerHTML= selHtml //设置所有班级的下拉框
  // selectClass.onchange = function(){console.log(selectClass.selectedIndex)}
  var state = 0;//定义状态，开始和结束
  var t;
  var tout
  var sj;
  var arr;
  addtea.onclick = function () {
    if(arr[sj].indexOf(' ')<0){
      arr[sj] = arr[sj]+' 1'
    }else{
      var temparr = arr[sj].split(' ');
      arr[sj] = temparr[0]+' '+(1+Number(temparr[1]));
    
    }
    console.log(arr[sj])
    luckyName.innerHTML = arr[sj];
  }
  addsalt.onclick = function () {
    if(arr[sj].indexOf(' ')<0){
      arr[sj] = arr[sj]+' -1'
    }else{
      var temparr = arr[sj].split(' ');
      arr[sj] = temparr[0]+' '+(Number(temparr[1])-1);
    
    }
    var temparr = arr[sj].split(' ');
    if(temparr[1] == '0'){
      arr[sj] = temparr[0]
    }
    console.log(arr[sj])
    luckyName.innerHTML = arr[sj];
  }
  var bgChange = -1;
  rdmContainer.style.backgroundImage = 'url()'
  addbg.onclick = function () {
    if(bgChange>0){
      rdmContainer.style.backgroundImage = 'url()'
    }else{
      rdmContainer.style.backgroundImage = 'url(./css/img/name_bg1.jpg)'
    }
    bgChange = bgChange *(-1);
    
    
  }
  luckyName.onclick = function () {
    arr = school[selectClass.selectedIndex].students
    clearTimeout(tout)
    if (state == 0) {
      //如果是0即开始随机，变为1时结束，不是0时执行else
      clearInterval(t);
      t = setInterval(function () {
        // console.log(1);
        sj = Math.round(Math.random() * (arr.length - 1));
        luckyName.innerHTML = arr[sj];
      }, 37)

      state = 1;
      tout = setTimeout(function () {
        state = 0;
        clearInterval(t);

      }, 1000 + Math.round(Math.random() * 1000));

    } else {
      state = 0;
      clearInterval(t);

    }
  }
</script>

</html>